<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
    <style>
        /* Basic styling for the page */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f6f9;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        .container {
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px;
            padding: 20px;
            text-align: center;
        }

        h2 {
            color: #333;
            margin-bottom: 20px;
        }

        p {
            color: #555;
            margin-bottom: 20px;
        }

        /* Button styles */
        .btn {
            background-color: purple;
            color: white;
            border: none;
            border-radius: 5px;
            outline: none;
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            background-color: #0056b3;
        }

        /* Display area styling */
        #result-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            display: none; /* Initially hidden */
        }

        #result-container h3 {
            color: #333;
            margin-bottom: 10px;
        }

        #result-container p {
            color: #555;
            margin: 5px 0;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>QR Code Scanner</h2>
    <p>Click the button below to start scanning a QR code with your camera.</p>
    <button class="btn" id="scanButton">Scan QR Code</button>

    <!-- Container to display scan results -->
    <div id="result-container">
        <h3>Scan Result</h3>
        <p id="name"></p>
        <p id="email"></p>
        <p id="ticketCount"></p>
        <p id="paymentStatus"></p>
    </div>
</div>

<script>
    // JavaScript to handle button click and update UI
    document.getElementById('scanButton').addEventListener('click', async function () {
        try {
            // Make a POST request to initiate scanning on the backend
            const response = await fetch('/api/scan', {
                method: 'POST'
            });

            if (!response.ok) {
                throw new Error('Failed to scan QR Code');
            }

            const result = await response.json();

            // Check if a matching record was found
            const resultContainer = document.getElementById('result-container');
            if (result && result.success) {
                // Populate data into the result container
                document.getElementById('name').innerText = "Name: " + result.name;
                document.getElementById('email').innerText = "Email: " + result.email;
                document.getElementById('ticketCount').innerText = "Number of Tickets: " + result.numberOfTickets;
                document.getElementById('paymentStatus').innerText = "Payment Status: " + (result.isPaid ? "Paid" : "Not Paid");

                // Make the result container visible
                resultContainer.style.display = 'block';
            } else {
                // Show no matching record message
                resultContainer.style.display = 'block';
                document.getElementById('name').innerText = "No matching record found for the QR code.";
                document.getElementById('email').innerText = "";
                document.getElementById('ticketCount').innerText = "";
                document.getElementById('paymentStatus').innerText = "";
            }
        } catch (error) {
            alert('Error scanning QR code: ' + error.message);
        }
    });
</script>
</body>
</html>


<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->

<!--<head>-->
<!--    <title>Scan QR Code</title>-->
<!--    <style>-->
<!--        #result {-->
<!--            padding: 20px;-->
<!--            font-size: 18px;-->
<!--            margin-top: 20px;-->
<!--        }-->

<!--        .status-paid {-->
<!--            color: green;-->
<!--            font-weight: bold;-->
<!--        }-->

<!--        .status-not-paid {-->
<!--            color: red;-->
<!--            font-weight: bold;-->
<!--        }-->

<!--        button {-->
<!--            background-color: purple;-->
<!--            color: white;-->
<!--            border: none;-->
<!--            border-radius: 5px;-->
<!--            padding: 10px 20px;-->
<!--            font-size: 1rem;-->
<!--            cursor: pointer;-->
<!--            transition: background-color 0.3s ease;-->
<!--        }-->

<!--        button:hover {-->
<!--            background-color: #45a049;-->
<!--        }-->

<!--    </style>-->


<!--</head>-->
<!--<body>-->
<!--<h1>Scan QR Code</h1>-->

<!--<form action="/scan" method="post" enctype="multipart/form-data">-->
<!--    <label>Choose Text File:</label>-->
<!--    <input type="file" id="file-input" name="file" accept=".txt" style="opacity: 0; position: absolute; z-index: -1;"/>-->
<!--    <input type="file" name="file" accept=".png,.jpg,.jpeg,">-->

<!--    <div class="form-actions">-->
<!--        <button type="submit">Scan</button>-->
<!--    </div>-->

<!--</form>-->
<!--<p th:text="${message}"></p>-->
<!--<p th:if="${result != null}" th:text="'QR Code Data: ' + ${result}"></p>-->
<!--<p th:if="${matchMessage != null}" th:text="${matchMessage}"></p>-->

<!--&lt;!&ndash; Div for QR Code scanning &ndash;&gt;-->
<!--<div id="reader" style="width: 500px;"></div>-->
<!--<br>-->
<!--<button id="stop-camera">Stop Camera</button>-->

<!--&lt;!&ndash; Div to show scanning results &ndash;&gt;-->
<!--<div id="result"></div>-->

<!--&lt;!&ndash; Script loading &ndash;&gt;-->
<!--&lt;!&ndash; QR code reader library &ndash;&gt;-->
<!--<script>-->
<!--    // Define the URL for the QR Code library script-->
<!--    const QR_CODE_SCRIPT_URL = "https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js";-->
<!--</script>-->
<!--<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>-->

<!--<script>-->
<!--    const qrCodeReader = new Html5Qrcode("reader");-->

<!--    function startScanning() {-->
<!--        qrCodeReader.start(-->
<!--            {facingMode: "environment"}, // Use the back camera-->
<!--            {-->
<!--                fps: 10,       // Scans per second-->
<!--                qrbox: 250     // Size of scanning box-->
<!--            },-->
<!--            qrCodeMessage => {-->
<!--                // Call the backend API upon QR code detection-->
<!--                fetch('/api/qrscanner/scan', {-->
<!--                    method: 'POST',-->
<!--                    headers: {-->
<!--                        'Content-Type': 'application/json'-->
<!--                    },-->
<!--                    body: JSON.stringify({qrCodeData: qrCodeMessage})-->
<!--                })-->
<!--                    .then(response => response.json())-->
<!--                    .then(data => {-->
<!--                        const resultDiv = document.getElementById('result');-->

<!--                        if (data.success) {-->
<!--                            // Display user details-->
<!--                            resultDiv.innerHTML = `-->
<!--                                <p>Name: ${data.name}</p>-->
<!--                                <p>Email: ${data.email}</p>-->
<!--                                <p>Number of Tickets: ${data.numberOfTickets}</p>-->
<!--                                <p class="${data.paid ? 'status-paid' : 'status-not-paid'}">-->
<!--                                    ${data.paid ? 'Payment Status: OK (Paid)' : 'Payment Status: Not Paid'}-->
<!--                                </p>-->
<!--                            `;-->
<!--                        } else {-->
<!--                            resultDiv.innerHTML = `<p class="status-not-paid">${data.message}</p>`;-->
<!--                        }-->
<!--                    })-->
<!--                    .catch(error => console.error('Error:', error));-->
<!--            },-->
<!--            errorMessage => {-->
<!--                console.warn(`QR Code scanning error: ${errorMessage}`);-->
<!--            }-->
<!--        )-->
<!--            .catch(err => {-->
<!--                console.error("Unable to start camera: ", err);-->
<!--            });-->
<!--    }-->

<!--    // Start scanning when the page loads-->
<!--    window.onload = startScanning;-->

<!--    // Add event listener to the stop button-->
<!--    document.getElementById('stop-camera').addEventListener('click', () => {-->
<!--        qrCodeReader.stop()-->
<!--            .then(() => {-->
<!--                console.log("Camera stopped.");-->
<!--            })-->
<!--            .catch(err => {-->
<!--                console.error("Error stopping the camera: ", err);-->
<!--            });-->
<!--    });-->
<!--</script>-->


<!--</body>-->
<!--</html>-->
